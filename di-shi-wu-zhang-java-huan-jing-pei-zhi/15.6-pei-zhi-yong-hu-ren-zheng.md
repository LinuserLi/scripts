---
description: >-
  通常我们发布都是通过运维人员发war 包到服务器上。其实还有一种方法，就是让开发人员自己发war ，这种方式是通过web
  方式。要想使用这种方式，那么运维人员必须在服务器上打开 tomcat 的 manager ，即用户认证管理。
---

# 15.6：配置用户认证

tomcat 项目主页上有三个按钮，分别为：

![](../.gitbook/assets/20180422010.jpg)

点击任何一个进去提示：

![](../.gitbook/assets/20180422011.jpg)



 先来看下 {catalina.home}/webapps 目录下的目录结构，可以看出，host-manager 和 manager 是单独的项目，可以单独管理，对应的就是tomcat 项目首页中的 Manager APP 和 Host Mananger 两个应用。在 tomcat 7 中点击无需任何配置点击首页中的两个应用都会弹出输入用户名和密码的验证框，但是，到8 上有改变，默认给的是403 的提示。那么我们怎么去配置启用上面的功能呢？

1、看官网给出的文档提示：

 A default Tomcat installation includes the Manager. To add an instance of the Manager web application `Context` to a new host install the `manager.xml` context configuration file in the `$CATALINA_BASE/conf/[enginename]/[hostname]` folder. Here is an example:

```java
<Context privileged="true" antiResourceLocking="false"
         docBase="${catalina.home}/webapps/manager">
  <Valve className="org.apache.catalina.valves.RemoteAddrValve"
         allow="127\.0\.0\.1" />
</Context>
```

按照上面的提示，我们在 tomcat/conf/catalina/localhost 目录创建manager.xml 文件，内容为：

```java
<Context privileged="true" antiResourceLocking="false" docBase="${catalina.home}/webapps/manager">
    <Valve className="org.apache.catalina.valves.RemoteAddrValve" allow="192\.168\.137\.1" />
</Context>
```

同时，也在 tomcat/conf/catalina/localhost 目录创建 host-manager.xml 文件，内容为：

```java
<Context privileged="true" antiResourceLocking="false" docBase="${catalina.home}/webapps/host-manager">
    <Valve className="org.apache.catalina.valves.RemoteAddrValve" allow="^.*$" />
</Context>
```

创建好访问APP 并授权后，还需要编辑用户授权文件  /usr/local/tomcat/conf/tomcat-users.xml ，增加角色并配置好验证用户：

```java
<tomcat-users>
	<role rolename="manager-gui"/>
	<role rolename="admin-gui"/>
	<user username="tomcat" password="s3cret" roles="manager-gui"/>
    <user username="admin" password="aaa111" roles="admin-gui"/>
</tomcat-users>
```

重启下tomcat:

```bash
[root@centos ~]# systemctl restart tomcat
```

2、在浏览器打开 tomcat ，点击 Server Status 和 Manage App 则会要求输入密码：

![](../.gitbook/assets/20180423001.jpg)

点击Server Status 输入配置的密码，查看Server Status:

![](../.gitbook/assets/20180423002%20%281%29.jpg)

回到tomcat 项目，再次点击 Manager App ，则直接进入应用管理：

![](../.gitbook/assets/20180423003.jpg)

点击管理中 /  后面的 stop ，停止主项目 tomcat:

![](../.gitbook/assets/20180423004.jpg)

再次测试访问主项目：

![](../.gitbook/assets/20180423005.jpg)

在此点击start :

![](../.gitbook/assets/20180423006.jpg)

再次访问：

![](../.gitbook/assets/20180423007.jpg)

